{% load static %}

<div id="condition-builder" class="border rounded-lg p-3 bg-white shadow">
    <!-- Condition builder will be rendered here by condition_builder.js -->
</div>

<script type="module">
    import { initConditionBuilder } from "{% static 'strategies/main.js' %}";
    
    let indicatorsData = [];

    fetch('/api/strategies/indicators/')
        .then(res => {
            if (res.status === 400) {
                window.location.href = '/backtests/';
                return;
            }
            return res.json();
        })
        .then(data => {
            indicatorsData = data.indicators;

            const conditionBuilder = initConditionBuilder(
                    '#condition-builder',
                    indicatorsData
                );

            document.getElementById('hide-strategy-builder')
                ?.addEventListener('click', () => {
                    conditionBuilder.clear();
                });
        });
</script>